<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solit Legend Rewards</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to right, #1e1e2f, #2d2d4d);
      color: white;
      overflow-x: hidden;
    }
    .screen {
      display: none;
      min-height: 100vh;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 20px;
      animation: fadeIn 0.6s ease-in-out;
    }
    .active { display: flex; }
    input, button {
      padding: 12px;
      margin-top: 12px;
      border-radius: 10px;
      border: none;
      font-size: 1rem;
    }
    button {
      background: #ff4f5a;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #ff6a75;
    }
    .rewards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 30px;
      width: 100%;
    }
    .reward-card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.3s, background 0.3s;
    }
    .reward-card:hover {
      transform: translateY(-5px);
      background: rgba(255, 255, 255, 0.1);
    }
    .reward-card img {
      width: 80px;
      height: 80px;
      margin-bottom: 10px;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    .channel-link {
      margin-top: 30px;
      font-size: 0.9rem;
      text-align: center;
      color: #ccc;
    }
    .channel-link a {
      color: #00e676;
      text-decoration: none;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div class="screen" id="loginScreen">
  <h2>Welcome to <span style="color:#ff4f5a">Solit Legend Rewards</span></h2>
  <input type="text" id="username" placeholder="Enter your name" />
  <button onclick="startApp()">Start</button>
</div>

<div class="screen" id="mainScreen">
  <h2>Hello, <span id="displayName"></span>!</h2>
  <div id="user-coins" style="margin-top: 10px; font-weight: bold;">Loading coins...</div>
  <button onclick="watchAdAndEarn()">üé• Watch & Earn</button>
  <button onclick="showSpinWheel()">üé∞ Spin & Earn</button>
  <button onclick="logout()">üö™ Logout</button>
  <div class="rewards-grid" id="rewardsGrid"></div>
  <div class="channel-link">
    üîî For new updates & events, <a href="https://whatsapp.com/channel/0029VbAnDs1Fsn0WgNbrMl01" target="_blank">Follow our WhatsApp Channel</a><br>
    üí∏ Earn more rewards!
  </div>
</div>

<div class="screen" id="spinWheelScreen">
  <h2>üéØ Spin & Win Coins</h2>
  <canvas id="wheelCanvas" width="300" height="300"></canvas>
  <button onclick="spin()">Spin Now</button>
  <button onclick="goBack()">Go Back</button>
</div>

<audio id="clickSound" src="https://www.soundjay.com/buttons/sounds/button-16.mp3" preload="auto"></audio>

<script>
  const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx511ZTDJCAGz4PTrloQbMOVkAtJw8IwbzZl4gUJqsPG7v908GbF7AlBinDpuQ_L9ERrA/exec';
  let userName = '';
  let userCoins = 0;
  let selectedReward = null;
  const clickSound = document.getElementById('clickSound');

  const rewards = [
    { title: 'Cash Rs.10', coins: 100, img: 'https://img.icons8.com/color/96/money.png' },
    { title: 'Cash Rs.30', coins: 300, img: 'https://img.icons8.com/color/96/money.png' },
    { title: 'Cash Rs.50', coins: 500, img: 'https://img.icons8.com/color/96/money.png' },
    { title: 'Cash Rs.100', coins: 1000, img: 'https://img.icons8.com/color/96/money.png' },
    { title: 'PUBG 60 UC', coins: 1000, img: 'https://img.icons8.com/color/96/pubg.png' },
    { title: 'Free Fire 210 UC', coins: 4000, img: 'https://img.icons8.com/color/96/fire-element.png' },
    { title: 'Discord Nitro', coins: 4000, img: 'https://img.icons8.com/color/96/discord-logo.png' },
    { title: 'Netflix 1 Month', coins: 4000, img: 'https://img.icons8.com/color/96/netflix-desktop-app.png' },
    { title: 'Minecraft Java Account', coins: 10000, img: 'https://img.icons8.com/color/96/minecraft-logo.png' }
  ];

  function startApp() {
    const name = document.getElementById('username').value.trim();
    if (!name) return alert("Enter your name");
    userName = name;
    localStorage.setItem("solitName", name);
    document.getElementById("displayName").innerText = name;
    showScreen("mainScreen");
    loadCoins();
    loadRewards();
    clickSound.play();
  }

  function showScreen(id) {
    document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  }

  function loadCoins() {
    fetch(`${SCRIPT_URL}?action=get&name=${userName}`)
      .then(res => res.text())
      .then(coin => {
        userCoins = parseInt(coin || 0);
        document.getElementById("user-coins").innerText = `You have: ${userCoins} coins`;
      });
  }

  function loadRewards() {
    const grid = document.getElementById("rewardsGrid");
    grid.innerHTML = '';
    rewards.forEach(r => {
      const div = document.createElement("div");
      div.className = "reward-card";
      div.innerHTML = `<img src="${r.img}" /><h4>${r.title}</h4><p>${r.coins} Coins</p>`;
      div.onclick = () => tryRedeem(r);
      grid.appendChild(div);
    });
  }

  function tryRedeem(reward) {
    if (userCoins < reward.coins) {
      alert("Not enough coins!");
      return;
    }
    selectedReward = reward;
    document.body.innerHTML = `
      <div style="text-align:center;padding:30px;color:white;background:#1e1e2f;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;">
        <h2>üõí Confirm Redemption</h2>
        <p style="margin-top:10px;">Do you want to redeem <strong>${reward.title}</strong> for <strong>${reward.coins}</strong> coins?</p>
        <div style="margin-top:20px;">
          <button onclick="confirmRedemption()" style="margin-right:10px;padding:10px 20px;background:#4caf50;border:none;border-radius:8px;font-weight:bold;">‚úÖ Confirm</button>
          <button onclick="location.reload()" style="padding:10px 20px;background:#f44336;border:none;border-radius:8px;font-weight:bold;">‚ùå Cancel</button>
        </div>
      </div>
    `;
  }

  function confirmRedemption() {
    fetch(`${SCRIPT_URL}?action=redeem&name=${userName}&reward=${selectedReward.title}&coins=${selectedReward.coins}&contact=manual`)
      .then(res => res.text())
      .then(text => {
        if (text === "Redeemed") {
          showFinalRedeemPage(selectedReward);
        } else {
          alert("Error: " + text);
          location.reload();
        }
      });
  }

  function showFinalRedeemPage(reward) {
    document.body.innerHTML = `
      <div style="text-align:center;padding:30px;color:white;background:#1e1e2f;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;">
        <h2>‚úÖ Redemption Confirmed!</h2>
        <p>You redeemed: <strong>${reward.title}</strong></p>
        <p>Coins used: <strong>${reward.coins}</strong></p>
        <p>Please take a screenshot and send it to us:</p>
        <ul style="list-style:none;padding:0;font-size:16px;">
          <li>üìû WhatsApp: <b>03228076445</b></li>
          <li>üìß Gmail: <b>solitlegend@gmail.com</b></li>
          <li>üó®Ô∏è Discord: <b>legend031</b></li>
        </ul>
        <p>üîó <a href="https://whatsapp.com/channel/0029VbAnDs1Fsn0WgNbrMl01" target="_blank" style="color:#00e676;">Join our WhatsApp Channel</a></p>
        <button onclick="window.location.reload()" style="margin-top:20px;background:#ff4f5a;padding:10px 20px;border:none;border-radius:10px;color:white;cursor:pointer;">Back to App</button>
      </div>
    `;
  }

  function logout() {
    localStorage.removeItem("solitName");
    window.location.reload();
  }

  function showSpinWheel() {
    const lastSpin = localStorage.getItem("lastSpinDate");
    const today = new Date().toISOString().slice(0, 10);
    if (lastSpin === today) {
      alert("You've already spun today. Come back tomorrow!");
      return;
    }
    showScreen("spinWheelScreen");
    drawWheel();
  }

  function drawWheel() {
    const canvas = document.getElementById('wheelCanvas');
    const ctx = canvas.getContext('2d');
    const values = [2, 4, 6, 8, 10, 12, 14, 16, 18, 20];
    const colors = ['#ff4f5a', '#4caf50', '#3f51b5', '#ff9800', '#009688'];
    const total = values.length;
    const arc = (2 * Math.PI) / total;

    for (let i = 0; i < total; i++) {
      const angle = i * arc;
      ctx.beginPath();
      ctx.fillStyle = colors[i % colors.length];
      ctx.moveTo(150, 150);
      ctx.arc(150, 150, 140, angle, angle + arc);
      ctx.fill();
      ctx.fillStyle = "#fff";
      ctx.font = "bold 16px Poppins";
      ctx.textAlign = "center";
      ctx.fillText(values[i] + "üí∞", 150 + Math.cos(angle + arc / 2) * 100, 150 + Math.sin(angle + arc / 2) * 100);
    }
  }

  function spin() {
    const values = [2, 4, 6, 8, 10, 12, 14, 16, 18, 20];
    const reward = values[Math.floor(Math.random() * values.length)];

    fetch(`${SCRIPT_URL}?action=add&name=${userName}&coins=${reward}`)
      .then(() => {
        alert(`üéâ You won ${reward} coins!`);
        localStorage.setItem("lastSpinDate", new Date().toISOString().slice(0, 10));
        loadCoins();
        showScreen("mainScreen");
      });
  }

  function goBack() {
    showScreen("mainScreen");
  }

  window.onload = () => {
    const stored = localStorage.getItem("solitName");
    if (stored) {
      userName = stored;
      document.getElementById("displayName").innerText = userName;
      showScreen("mainScreen");
      loadCoins();
      loadRewards();
    } else {
      showScreen("loginScreen");
    }
  };
</script>

</body>
</html>
